<!DOCTYPE html>
<html>
  <head>
    <!-- åŠ è¼‰ LINE LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
      async function initializeLiff() {
        await liff.init({ liffId: "2001397246-jbLPM3xw" });
      }

      initializeLiff();
    </script>
    <style>
      /* è‡ªå®šç¾©åˆ†äº«æŒ‰éˆ•çš„æ¨£å¼ */
      #lineShareButton {
        position: fixed;
        /* bottom: 20px; */
        top: 20px;
        right: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        z-index: 9999; /* å°‡ z-index è¨­ç½®ç‚ºä¸€å€‹è¶³å¤ é«˜çš„å€¼ */
      }

      #lineShareButton img {
        width: 60px; /* èª¿æ•´åœ–ç‰‡å¯¬åº¦ */
        height: auto;
      }

      #lineShareButton p {
        margin: 0; /* æ¸…é™¤é è¨­é‚Šè· */
      }
    </style>
  </head>
  <body>
    <!-- åˆ†äº«æŒ‰éˆ• -->
    <div id="lineShareButton">
      <button style="background: none; border: none; cursor: pointer">
        <img src="/images/line-icon.png" alt="LINE APP åœ–ç‰‡" />
        <p>åˆ†äº«å¥½å‹</p>
      </button>
    </div>
    <script>
      // ç²å–åˆ†äº«æŒ‰éˆ•å…ƒç´ 
      const shareButton = document.getElementById("lineShareButton");

      window.addEventListener("scroll", function () {
        var scrollY = window.scrollY || window.pageYOffset;
        if (scrollY > 100) {
          // é é¢æ»¾å‹•å¤§æ–¼100åƒç´ éš±è—
          shareButton.style.display = "none";
        } else {
          shareButton.style.display = "flex"; // å¦å‰‡é¡¯ç¤ºæŒ‰éˆ•
        }
      });

      function isMobileUser() {
        return /Mobile|Mobi/i.test(navigator.userAgent);
      }

      shareButton.addEventListener("click", () => {
        // åˆ¤æ–­ç”¨æˆ¶ç’°å¢ƒï¼Œå¦‚æœåœ¨Lineå®¢æˆ·ç«¯ä¸­ï¼Œä½¿ç”¨LIFFåˆ†äº«
        if (typeof liff !== "undefined" && isMobileUser()) {
          console.log("isMobile");
          // å–å¾— Line å¥½å‹ä¿¡æ¯
          liff.getProfile().then((profile) => {
            console.log("profile", profile);
            const nickname = profile.displayName;
            const shareText = `å¥½å‹ ${nickname} åˆ†äº«äº†é€™å€‹é€£çµğŸ˜Š: https://chrislinovo.github.io/about/`;
            // ä½¿ç”¨ LIFF åˆ†äº«
            console.log("shareText", shareText);
            if (liff.isApiAvailable("shareTargetPicker")) {
              liff
                .shareTargetPicker([
                  {
                    type: "text",
                    text: shareText,
                  },
                ])
                .then(() => {
                  console.log("åœ¨ Line å®¢æˆ·ç«¯ä¸­åˆ†äº«æˆåŠŸ");
                })
                .catch((error) => {
                  console.log("error ", shareText);
                  console.error("åœ¨ Line å®¢æˆ·ç«¯ä¸­åˆ†äº«å¤±æ•—", error);
                });
            } else {
              alert(
                "ä½ çš„ LINE App æš«æ™‚ä¸æ”¯æ´ Share Target Picker ï¼Œå°‡é–‹å§‹å¤–éƒ¨ç€è¦½å™¨ã€‚"
              );
            }
            if (liff.isApiAvailable("multipleLiffTransition")) {
              window.location.href = "https://line.me/2001397246-jbLPM3xw";
            }
          });
        } else {
          // å¦‚æœæ˜¯ç¶²é ï¼Œä½¿ç”¨ LINE Web Share Button
          window.open(
            "https://lineit.line.me/share/ui?url=" + window.location.href
          );
        }
      });
    </script>
  </body>
</html>
