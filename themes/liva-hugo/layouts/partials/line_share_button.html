<!DOCTYPE html>
<html>
  <head>
    <!-- åŠ è¼‰ LINE LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
      /* è‡ªå®šç¾©åˆ†äº«æŒ‰éˆ•çš„æ¨£å¼ */
      #lineShareButton {
        position: fixed;
        bottom: 20px;
        right: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        z-index: 9999; /* å°‡ z-index è¨­ç½®ç‚ºä¸€å€‹è¶³å¤ é«˜çš„å€¼ */
      }

      #lineShareButton img {
        width: 60px; /* èª¿æ•´åœ–ç‰‡å¯¬åº¦ */
        height: auto;
      }

      #lineShareButton p {
        margin: 0; /* æ¸…é™¤é è¨­é‚Šè· */
      }
    </style>
  </head>
  <body>
    <!-- åˆ†äº«æŒ‰éˆ• -->
    <div id="lineShareButton">
      <button
        onclick="shareToLINE()"
        style="background: none; border: none; cursor: pointer"
      >
        <img src="/images/line-icon.png" alt="LINE APP åœ–ç‰‡" />
        <p>åˆ†äº«å¥½å‹</p>
      </button>
    </div>

    <script>
      function shareToLINE() {
        // æª¢æŸ¥ç”¨æˆ¶è¨ªå•è¨­å‚™ï¼Œå¦‚æœæ˜¯æ‰‹æ©Ÿï¼Œå•Ÿç”¨ LINE LIFF
        var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
          navigator.userAgent
        );

        // ç²å–åˆ†äº«æŒ‰éˆ•å…ƒç´ 
        var shareButton = document.getElementById("lineShareButton");

        // æ·»åŠ é»æ“Šäº‹ä»¶ç›£è½å™¨
        shareButton.addEventListener("click", function () {
          // ç²å–ç•¶å‰ç¶²é çš„ URL
          var currentURL = window.location.href;

          var sharedText = `ä¾†è‡ª${getUserName()}çš„åˆ†äº«ğŸ‰`;

          // ä½¿ç”¨ LINE åˆ†äº«åŠŸèƒ½åˆ†äº« URL
          if (isMobile) {
            // å¦‚æœæ˜¯æ‰‹æ©Ÿï¼Œä½¿ç”¨ LINE LIFF
            if (typeof liff !== "undefined") {
              liff
                .init({ liffId: "2001397246-jbLPM3xw" })
                .then(function () {
                  if (!liff.isLoggedIn()) {
                    liff.login(); // å¦‚æœç”¨æˆ¶æœªç™»éŒ„ï¼Œæç¤ºç”¨æˆ¶ç™»éŒ„
                  }
                  // ä½¿ç”¨ liff.shareTargetPicker åˆ†äº« URL çµ¦ LINE å¥½å‹
                  liff.shareTargetPicker([
                    {
                      type: "text",
                      text: sharedText,
                    },
                    {
                      type: "url",
                      title: "åˆ†äº«çš„ç¶²é ",
                      url: `https://lineit.line.me/share/ui?url=${currentURL}`,
                    },
                  ]);
                })
                .catch(function (error) {
                  console.error(error);
                });
            }
          } else {
            // å¦‚æœæ˜¯ç¶²é ï¼Œä½¿ç”¨ LINE Web Share Button
            window.open(`https://lineit.line.me/share/ui?url=${currentURL}`);
          }
        });
      }
    </script>
  </body>
</html>
